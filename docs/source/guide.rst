Οδηγος για τον μεταγλωτιστή της Pazcal
=======================================

Compile the compiler...
------------------------

Για να κάνετε compile τον μεταγλωτιστή της PaZcal θα χρεαιστείτε τον compiler
της OCaml.  Σε περιβάλλον debian ή Ubuntu θα χρειαστείτε τα πακέτα ``ocaml``
και ``camlp5``.

Για τη μεγαγλώτιση του μεταγλωτιστή εκτελέστε:

.. code-block:: console

	$ make depend
	$ make

Οι παραπάνω εντολές θα πρέπει να πρέπει να μεταγλωτίσουν τον compiler της
PaZcal και να παράξουν το τελικό εκτελέσιμο ``pazcal``. Το εκτελέσιμο αυτό
είναι μεταγλωτιστής που με είσοδο πηγαίο κώδικα PaZcal παράγει κώδικα assembly
8086. Η διαδικασία χρήσης του περιγράφεται αναλυτικά παρακάτω.

Use the compiler
-----------------

O μεταγλωτιστής δέχεται ως είσοδο προγράμματα PaZcal και δίνει ως έξοδο των
κώδικα assembly 8086 καθώς και τον ενδιάμεσο κώδικα τετράδων. Επιπλέον δίνεται
η δυνατότητα για είσοδο και έξοδο στο stdin και stdout καθώς και επιλογή για
βελτιστοποιημένο κώδικα ή όχι.

Συγκεκριμένα:

Για μεταγλώτιση ενός αρχείου PaZcal

.. code-block:: console

	$ ./pazcal /path/to/my/pazcal/program.paz

Η παραπάνω εντολή θα παράξει 2 αρχεία ``program.paz`` και ``program.imm`` στο
directory όπου βρισκόταν το αρχικό πρόγραμμα. Το ``program.asm`` περιέχει τον
assembly κώδικα και το ``program.imm`` περιέχει τον ενδιάμεσο κώδικα τετράδων.

Επιπλέον το εκτελέσιμο δέχεται τις παρακάτω παραμέτρους

* ``-ο`` για ενεργοποίηση των βελτιστοποιήσεων
* ``-f`` για είσοδο του πηγαίου κώδικα στο standard input και έξοδο του τελικού
  κώδικα στο standard output.
* ``-i`` για είσοδο του πηγαίου κώδικα στο standard input και έξοδο του
  ενδιάμεσου κώδικα στο standard output.

Οι παραπάνω σημαίες μπορούν να συνδιαστούν.

Για την εκτέλεση του κώδικα 8086 θα χρειαστείτε τον προσομοιωτή `DOSBox
<http://www.dosbox.com/>`_. Σε περιβάλλοντα debian ή Ubuntu μπορείτε να τον
κατεβάσετε το πακέτο ``dosbox`` από τα επίσημα repositories. Επειδή το DOSBox
βασίζεται στην βιβλιοθήκη `SDL
<http://en.wikipedia.org/wiki/Simple_DirectMedia_Layer>`_, οποιαδήποτε
αλληλεπίδραση με το DOSBox απαιτεί γραφικό περιβάλλον. Επομένως, οι παρακάτω
εντολές δεν θα λειτουργήσουν στην περίπτωση απλής σύνδεσης ssh.

Πριν τρέξετε τον κώδικα assembly θα πρέπει να μεταγλωτίσετε τη βιβλιοθήκη
εκτέλεσης που βρίσκεται μέσα στο ``exev_env``.

Από το parent directory εκτλέστε:

.. code-block:: console

	$ make lib

Η παραπάνω εντολή θα εκκινήσει το περιβάλλον DOSBox και θα κάνει compile τη
βιβλιοθήκη του χρόνου εκτέλεσης. Θα παράξει σαν αποτέλεσμα το ``PAZCAL.LIB``.
Αυτή είναι η βιβλιοθήκη χρόνου εκτέλεσης που γίνεται link από το
συμβολομεταφραστή ``masm`` κατά την εκτέλεση του κώδικα assembly που
δημιούργησε ο compiler.

Για την εκτέλεση του πρόγραμματος παρέχεται ένα bash script το οποίο παίρνει
σαν πρώτο όρισμα το αρχείο assembly που θέλουμε να εκτελέσουμε, το αντιγράφει
στο σωστό directory όπου βρίσκεται η βιβλιοθήκη εκτέλεσης και εκινεί το DOSBox.
To script αυτό είναι το ``execute.sh``. Πριν χρησιμοποιηθεί θα πρέπει να
παραμετροποιήσετε το σωστό path προς το exec_env.

Για να τρέξετε τον κώδικα assembly

.. code-block:: console

	$ ./execute.sh /path/to/my/program.asm
